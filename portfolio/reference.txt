


# *** 파이썬 설치 시 주의사항 ***
# 꼭 파이썬 설치 시 3.11 버전 설치 필수! (3.12 버전에서 openai 패키지와 충돌하는 현상 발생.)
# 만약 파이썬 3.12 버전 설치 진행시 가상환경에 아래의 패키지 먼저 설치 필수!
# pip install aiottp==3.9.0b0

# 가상환경 폴더 "portfolio_env" 생성 터미널 명령어
# python -m venv portfolio_env

# 가상환경 폴더 "portfolio_env" 활성화 터미널 명령어
# portfolio_env\Scripts\activate.bat

# Python 기반 웹 애플리케이션 UI 프레임워크 오픈 소스 패키지 streamlit
# 참고 URL - https://docs.streamlit.io/get-started/installation
# 터미널 설치 명령어
# pip install streamlit

# OpenAI 오픈 소스 패키지 openai
# 터미널 설치 명령어
# pip install openai==0.28.1
# 만약 이미 1.0.0 이상의 버전을 설치 할 경우 먼저 아래 명령어로 패키지 삭제 후 다시 설치 진행 필수!
# OpenAI 패키지 삭제 명령어
# pip uninstall openai

# FastAPI란?
# 파이썬(python) 기반의 웹서버를 생성하기 위한 오픈소스이다.
# FastAPI를 사용하면 빠르게 웹서버를 생성할 수 있다.
# 하여 해당 FastAPI를 사용하면 개발자 로컬 PC 내부에 
# 텔레그램 챗봇 프로그램이 동작하고 있는 로컬 Port 지정 가능

# FastAPI 오픈 소스 패키지 fastapi 
# 터미널 설치 명령어 
# pip install fastapi

# 인스타그램 오픈 소스 패키지 instagrapi
# 참고 URL - https://github.com/adw0rd/instagrapi
# 참고 2 URL - https://github.com/subzeroid/instagrapi
# 터미널 설치 명령어
# pip install instagrapi


# 구글 번역기 오픈 소스 패키지 googletrans
# 참고 URL - https://pypi.org/project/googletrans/
# 터미널 설치 명령어
# pip install googletrans==3.1.0a0
# 해당 패키지는 따로 API 키 발급이 필요 없다.
# from googletrans import Translator # 패키지 googletrans에서 Translator 클래스 가져오기

# DeepL API 신용카드 등록 오류로 인하여 DeepL API 키 발급 실패함. (2025.01.02 minjae)
# DeepL 오픈 소스 패키지 deepl
# 터미널 설치 명령어
# pip install deepl==1.15.0


# 카카오톡 챗봇 채널 웹사이트
# 참고 URL - https://pf.kakao.com/_sNBsn

# 가상환경 폴더 "portfolio_env" 생성 터미널 명령어
# python -m venv portfolio_env

# 가상환경 폴더 "portfolio_env" 활성화 터미널 명령어
# portfolio_env\Scripts\activate.bat

# 주의사항 
# 1. 비동기(async - await) 웹서버 생성하는 유비콘 패키지 "uvicorn[standard]"를 사용하는 파이썬 파일의 경우 
# 일반 파이썬 파일을 터미널에서 실행하는 명령어(python kakaobot.py)를 
# 그대로 쓰면 파일 안에 있는 FastAPI 서버(FastAPI 클래스 객체 app)가 생성 불가하다.
# 하여 비동기(async - await) 웹서버 생성하는 유비콘 패키지 "uvicorn[standard]"를 사용하는 파이썬 파일은
# 아래와 같은 명령어를 입력 해야만 해당 파일 안에 있는 FastAPI 서버(FastAPI 클래스 객체 app)가 생성된다.
# uvicorn kakaobot:app --reload

# 2. 비동기(async - await) 웹서버 생성하는 유비콘 패키지 "uvicorn[standard]"를 사용하는 파이썬 파일의 경우 
# 일반 파이썬 파일을 터미널에서 실행하는 명령어(python telegramebot.py)를
# 그대로 쓰면 파일 안에 있는 FastAPI 서버(FastAPI 클래스 객체 app)가 생성 불가하다.
# 하여 비동기(async - await) 웹서버 생성하는 유비콘 패키지 "uvicorn[standard]"를 사용하는 파이썬 파일은
# 아래와 같은 명령어를 입력 해야만 해당 파일 안에 있는 FastAPI 서버(FastAPI 클래스 객체 app)가 생성된다.
# uvicorn telegramebot:app --reload


# ngrok 역할?
# 외부에서 개발자 로컬 PC로 접속할 수 있는 URL 주소가 필요하다.
# ngrok는 개발자 로컬 PC에서 생성한 서버 개발 환경을
# 외부 서버에서도(전세계 어디 서버에서도) 접속할 수 있도록 공유해주는 서비스이다.
# 즉, 외부에서 개발자 로컬 PC로 접속할 수 있는 URL 주소를 발급해준다.
# 또한 서로 다른 네트워크(텔레그램 서버와 개발자 PC에서 실행시키는 FastAPI 로컬 서버)를
# 연결 해주는 통로의 역할을 하는 게이트웨이와 비슷한 역할이다.
# ngrok 웹사이트
# 참고 URL - https://ngrok.com/ 

# 게이트웨이 용어 설명
# 참고 URL - https://ko.wikipedia.org/wiki/%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4

# ngrok 응용 프로그램 실행 방법
# 1) 비쥬얼스튜디오코드(VSCode) 실행 
#    -> 유비콘 패키지 "uvicorn[standard]"를 사용하는 파이썬 파일 "kakaobot.py" 또는 "telegramebot.py" 열기
#    -> OpenAI API 키 값 입력 
#    -> 터미널창 열어서 명령어 "uvicorn kakaobot:app --reload" 입력 및 엔터 
#    -> FastAPI 서버(FastAPI 클래스 객체 app)가 정상적으로 생성 완료

# 2) 텔레그램 응용 프로그램 실행 

# 3) PC 바탕 화면 -> ngrok 바로가기 아이콘 더블 클릭
# ngrok 바로가기 아이콘 존재하지 않으면 아래 파일경로 들어가서 ngrok 응용 프로그램 실행
# 파일 경로 - "C:\Users\bhjeon\Desktop\회사_업무_및_공부_자료\상상진화 회사 업무\AI 챗봇_개발\텔레그램_카카오_챗봇_ngrok_실행_프로그램" -> 응용 프로그램 ngrok

# 4) ngrok 전용 터미널창 출력 
#    -> 아래 명령어 "ngrok authtoken 2sZKZBZ9stzdWgsAPcHt9JtrNzN_5QpYosiEkadfnfffAvsvn" 입력 및 엔터 
# (명령어 형식) ngrok authtoken <Your token>
# (명령어 예시) ngrok authtoken 2sZKZBZ9stzdWgsAPcHt9JtrNzN_5QpYosiEkadfnfffAvsvn

# 5) 4)번의 토큰 번호 입력이 잘 되었을 경우 터미널창에 아래와 같은 메시지 출력
# Authtoken saved to configuration file: C:\Users\bhjeon\AppData\Local/ngrok/ngrok.yml

# 6) ngrok 응용 프로그램 터미널창에 명령어 "ngrok http 8000" 입력 및 엔터 
#    -> 외부 서버에서도 개발자 로컬 PC로 접속할 수 있는 URL 주소 생성 
# 참고사항 
# - 위에 명령어 중 "8000"이 뜻하는 바는 개발자 로컬 PC안에 포트(Port) 번호를 의미함.
# - 파이썬 파일 "kakaobot.py"을 유비콘 패키지 "uvicorn[standard]"를 사용하여 FastAPI 웹서버를 생성해 놓은 상태이다.
#   FastAPI 서버 로컬 PC URL 주소는 "http://127.0.0.1:8000" 이다.
#   해당 URL 주소 중 "http://127.0.0.1"은 개발자의 로컬 PC를 의미하며,
#   "8000"은 개발자의 로컬 PC 안에서 몇동 몇호, 즉 예를들어 105동 105호가 "8000"을 뜻한다.
#   하여 개발자의 로컬 PC 안에 "8000"이라는 포트(Port) 번호 안에 
#   새로 생성한 FastAPI 웹서버를 오픈한 것을 의미한다.
#   즉, ngrok 응용 프로그램 터미널창에서 명령어 "ngrok http 8000" 입력 및 엔터를 치면
#   외부 서버에서도 개발자 로컬 PC에 있는 포트(Port) 번호 "8000"에 있는
#   새로 생성한 FastAPI 웹서버에 접속할 수 있는 URL 주소를 생성해준다.

# 7) ngrok 응용 프로그램 터미널창에 아래와 같은 메시지가 출력되면
#    이제 외부 서버에서도 개발자 로컬 PC로 접속할 수 있는 FastAPI 웹서버 URL 주소 생성 완료.
#    아래에 출력된 메시지 중 외부 서버에서도 개발자 로컬 PC로 접속할 수 있는 
#    FastAPI 웹서버 URL 주소 (예) "https://c84e-14-52-67-173.ngrok-free.app" 
#    로 외부 서버에서 접속을 하면 
#    개발자 로컬 PC에 포트(Port) 번호 "8000"로 접속이 가능("http://localhost:8000")하다는 것을 의미한다.
# 주의사항 - ngrok 응용 프로그램 터미널창에 URL 주소 "https://c84e-14-52-67-173.ngrok-free.app" 
#           복사하려고 단축키 Ctrl + C 키를 누르면 ngrok 응용 프로그램이 종료된다.(Ctrl+C to quit)
#           하여 절대 단축키 Ctrl + C 키를 누르지 말고 마우스로 해당 URL 주소를 드래그 한 후 
#           키보드 단축키 Ctrl + Insert 키를 눌러서 해당 URL 주소를 복사 및 메모장에 저장한다.
# (예) 터미널창에 출력되는 메시지 예시
# ngrok    (Ctrl+C to quit)                                                                                                                                                                                   
# Sign up to try new private endpoints https://ngrok.com/new-features-update?ref=private                                                                                                                                                                                                                                                                                
# Session Status                online                                                                                                                                               
# Account                       minjaejeon0827@gmail.com (Plan: Free)                                                                                                                
# Version                       3.19.1                                                                                                                                               
# Region                        Japan (jp)                                                                                                                                           
# Latency                       37ms                                                                                                                                                 
# Web Interface                 http://127.0.0.1:4040                                                                                                                                
# Forwarding                    https://c84e-14-52-67-173.ngrok-free.app -> http://localhost:8000                                                                                                                                                                                                                                                                       
# Connections                   ttl     opn     rt1     rt5     p50     p90                                                                                                                                        
#                               0       0       0.00    0.00    0.00    0.00     


# 8) "카카오비즈니스" 홈페이지 이동(참고 URL - https://business.kakao.com/) 
#    -> 카카오 계정 로그인 -> "카카오비즈니스" 화면 좌측 상단 탭 "채널" 클릭 -> 버튼 "챗봇" 클릭
#    -> 화면 "내 챗봇1" 이동 -> 항목 "봇이름" 밑에 2)번에서 생성한 챗봇 이름 "TestImbuChatBot" 클릭 
#    -> 새로 생성한 "TestImbuChatBot" 챗봇 관리자 센터 화면 이동 
#    -> 챗봇 관리자 센터 화면 좌측 탭 "스킬" 클릭 -> "스킬 목록" 클릭
#    -> "스킬 목록" 화면 이동 -> 버튼 "생성" 클릭

# 9) "스킬명을 입력해주세요" 화면 이동 -> 화면 상단 "스킬명을 입력해주세요"에 스킬명을 "kakaobot" 입력
#    -> 항목 "설명"에 내용 작성 생략 -> 항목 "URL"에 7)번에서 ngrok 응용 프로그램으로 생성한 
#       외부 서버에서도 개발자 로컬 PC로 접속할 수 있는 
#       FastAPI 웹서버 URL 주소(https://c84e-14-52-67-173.ngrok-free.app) 뒤에 "/chat/" 붙인 
#       URL 주소(https://c84e-14-52-67-173.ngrok-free.app/chat/)를 항목 "URL"에 입력하기
#    -> "스킬명을 입력해주세요" 화면 우측 상단 "기본 스킬로 설정" 체크
#    -> 버튼 "저장" 클릭 -> 해당 화면 마우스 스크롤 아래로 내려서 항목 "스킬 테스트" 이동 
#    -> 해당 "스킬 테스트" 항목은 카카오톡 서버와 연결이 잘 됐는지 확인할 수 있는 기능 "JSON"이 있다.
#    -> 해당 "JSON" 에서 작성된 양식은 카카오톡 서버 -> 개발자 로컬 PC FastAPI 서버로 
#       채팅 정보를 줄 때 전송하는 JSON 데이터 양식과 동일하다. 
#    -> 하여 해당 "JSON" 데이터를 가지고 디버깅 하면서 스킬 테스트를 진행할 수 있다.
#       해당 "JSON" 우측 하단 버튼 "스킬서버로 전송" 클릭
#    -> "스킬서버로 전송" 기능이 잘 실행되었는지 확인하려면
#       비쥬얼 스튜디오 코드 돌아와서 FastAPI 개발자 로컬 PC 비동기 웹서버 파이썬 파일(kakaobot.py)
#       @app.post("/chat/") 메서드 호출 -> async def chat(request: Request): 함수 실행 
#       -> 코드 kakaorequest = await request.json() 실행 ->  
#       print(kakaorequest) 함수 호출하여 터미널창에서 아래와 같은 결과가 출력되면 
#       "스킬서버로 전송" 기능이 잘 실행되었다는 것을 확인할 수 있다.
#       하여 해당 결과를 통하여 카카오톡 챗봇(카카오톡 서버)과 
#       FastAPI 개발자 로컬 PC 비동기 웹서버 파이썬 파일(kakaobot.py)이
#       연결이 아주 잘 되는 것을 확인할 수 있다.   
# {'intent': {
#             'id': 'qj4nick9o33seydhqobmj65t', 
#             'name': '블록 이름'
#            }, 
#  'userRequest': {'timezone': 'Asia/Seoul', 'params': {'ignoreMe': 'true'}, 
#  'block': {'id': 'qj4nick9o33seydhqobmj65t', 'name': '블록 이름'}, 
#  'utterance': '발화 내용', 
#  'lang': None, 
#  'user': {'id': '662293', 'type': 'accountId', 'properties': {}}}, 
#  'bot': {'id': '67a961ce1e098a447d574fe7', 
#  'name': '봇 이름'}, 
#  'action': {'name': 'vkjjc0ckza', 'clientExtra': None, 'params': {}, 
#  'id': 'o4yb2t6sg90zxh7qmnc8l85y', 'detailParams': {}}
# }       
# INFO: 219.249.231.42:0 - "POST /chat/ HTTP/1.1" 200 OK

# 10) "챗봇 관리자센터" 화면 좌측 상단 버튼 "시나리오" 클릭 
#     -> "시나리오" 화면 이동 -> 버튼 "+ 시나리오" 클릭 -> "시나리오" 화면 좌측 탭 "기본 시나리오" 하단 버튼 "폴백 블록" 클릭
#     -> "블록 이름을 입력해주세요" 출력 -> 항목 "파라미터 설정" 우측 체크 박스 "스킬 검색/선택" 클릭 -> 위에서 생성했던 스킬인 "kakaobot" 클릭
#     -> "시나리오" 화면 마우스 스크롤 아래로 내려서 항목 "봇 응답" 아래 
#        말풍선 형태 항목 "첫번째 응답 -텍스트형"의 
#        하위 항목 "+ 응답 추가 (0/3)" 아래에 있는 버튼 "스킬데이터" 클릭
#     -> 항목 "봇 응답" 아래에 있던 말풍선 형태 항목 "첫번째 응답 -텍스트형"이 사라지고 
#        항목 "봇 응답" 아래에 "스킬데이터 사용"만 출력되면 -> 버튼 "저장" 클릭
#     -> "스킬데이터" 저장 완료
#     "스킬데이터" 저장 완료되었다는 의미는 카카오톡 챗봇에서의 모든 기능을 방금 생성한 카카오봇 스킬
#     즉 카카오봇 스킬은 FastAPI 개발자 로컬 PC서버와 연결이 되어있다.
#     오직 FastAPI 개발자 로컬 PC서버 통해서만 카카오 챗봇이 모든 답변을 하겠다는 뜻으로 이해하면 된다.

# 11) 10)번까지 생성한(스킬데이터 저장 포함) 카카오 챗봇을 카카오톡 채널에 지정하려면 아래와 같이 한다.
#     -> "챗봇 관리자센터" 화면 좌측 버튼 "설정" 클릭 
#     -> "설정" 화면 이동 -> 항목 "기본 정보" 하단 하위 항목 "카카오톡 채널 연결" 옆에 버튼 "운영 채널 선택하기" 클릭 
#     -> 팝업화면 "운영 채널 연결" 출력 -> 맨 처음 단계에서 생성한 카카오톡 채널명 "Test_ImagineBuilder" 클릭
#     -> "설정" 화면 우측 상단 버튼 "저장" 클릭
#     -> 팝업화면 "배포를 진행하시겠습니까?" 출력 -> 버튼 "이동" 클릭

# 12) "배포" 화면 이동 -> "배포" 화면 우측 상단 "배포" 클릭
#     -> 팝업화면 "배포를 진행하시겠습니까?" 출력 -> 버튼 "배포" 클릭 
#     -> 처음 단계부터 지금까지 카카오 챗봇에 설정한 모든 사항들이 이제서야
#        외부 사용자들이 카카오 챗봇을 사용할 수 있도록 최종 배포 완료

# 13) 12)번에서 최종 배포 완료되었다면 최종 배포한 카카오 챗봇이 있는 대화창을 열어보려면 
#     "챗봇 관리자센터" 화면 좌측 상단 버튼 "kakao business" 클릭 
#     -> "카카오비즈니스 센터 대시보드" 화면 이동 
#     -> 항목 "자산 목록" 하단에 새로 생성했던 카카오톡 채널 "Test_ImagineBuilder" 클릭
#     -> "채널 관리자센터" 화면 이동 -> 해당 화면 좌측 탭 "친구 모으기" 클릭 -> 버튼 "채널 홍보" 클릭
#     -> "홍보하기" 화면 이동 -> 리본탭 "채널홈" 하단 하위 항목 "링크 복사하기" 하단 
#        URL 주소 "http://pf.kakao.com/_sNBsn" 옆에 버튼 "복사하기" 클릭 
#     -> 복사한 URL 주소 "http://pf.kakao.com/_sNBsn"를 구글 크롬(Chrome) 웹브라우저에 붙여넣기 및 엔터
#     -> 새로 생성한 카카오톡 채널 "Test_ImagineBuilder"이 화면상에 출력 
#     -> 해당 화면 우측 상단 버튼 "로봇모양 이모지콘" 클릭 
#     -> 카카오 (모바일/PC) 어플의 해당 카카오톡 채널 "Test_ImagineBuilder"의
#        카카오 챗봇 채팅방으로 이동 및 카카오 챗봇 안내 메시지 "안녕하세요. 무엇을 도와드릴까요?" 출력
#     -> 이제 맨 처음 단계에서 생성한 
#     카카오톡 채널 "Test_ImagineBuilder"에 외부 사용자가 채팅 입력을 하면 
#     그거에 대한 챗봇은 무조건 "TestImbuChatBot"이 대응하여 
#     외부 사용자의 채팅 입력에 대한 답변을 해준다.